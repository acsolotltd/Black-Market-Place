{% extends "base.html" %}
{% load static %}
{% block title %}Afrimarket | Authentic African Traditional Products Marketplace{% endblock %}

{% block head_extra %}
  <meta name="description" content="Afrimarket — authentic African traditional medicine, beads, sculptures and cultural artifacts sourced from verified artisans. Fast shipping worldwide.">
  <link rel="canonical" href="{{ request.build_absolute_uri }}" />
  <!-- Preconnect for static CDN (adjust to your CDN) -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
{% endblock %}

{% block content %}
<main class=".pt-16 bg-neutral-950 text-neutral-100">

  <!-- HERO -->
  <section class="relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-amber-900/30 via-black to-black"></div>
    <div class="relative max-w-7xl mx-auto px-6 py-28 text-center">
      <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">
        Authentic African Traditional Products,
        <br><span class="text-amber-400">Delivered Globally</span>
      </h1>
      <p class="mt-6 max-w-2xl mx-auto text-lg text-neutral-300">
        Sourced from verified artisans and herbalists — beads, sculptures, and traditional remedies with clear origin & responsible sourcing.
      </p>
      <div class="mt-10 flex flex-col sm:flex-row justify-center gap-4">
        <a href="#categories" class="px-8 py-4 rounded-xl bg-amber-500 text-black font-semibold">Explore Categories</a>
        <a href="#featured-products" class="px-8 py-4 rounded-xl border border-neutral-700">Browse Popular</a>
      </div>
    </div>
  </section>

  <!-- CATEGORIES (primary navigation) -->
  <section id="categories" class="py-12 px-6 bg-black">
    <div class="max-w-7xl mx-auto">
      <h2 class="text-2xl font-semibold mb-6">Browse by Category</h2>
      <div class="grid sm:grid-cols-2 md:grid-cols-4 gap-4"
           hx-get="{% url 'core:explore_preview' %}"
           hx-trigger="revealed"
           hx-swap="innerHTML"
           aria-live="polite">
        <!-- category cards injected by HTMX -->
        <noscript>
          <!-- fallback: server-rendered categories here when JS disabled -->
        </noscript>
      </div>
    </div>
  </section>

  <!-- FEATURED PRODUCTS (concrete, conversion driver) -->
  <section id="featured-products" class="py-20 px-6 bg-neutral-950">
    <div class="max-w-7xl mx-auto">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-3xl font-bold">Popular This Week</h2>
          <p class="text-neutral-400 mt-1">Hand-picked and trending products from trusted vendors.</p>
        </div>
        <a href="{% url 'products:all-products' %}" class="text-neutral-400 hover:text-amber-400 text-sm">View all products →</a>
      </div>

      <!-- HTMX loads up to 8 featured items when this block is revealed -->
      <div class="grid sm:grid-cols-2 md:grid-cols-4 gap-6"
           hx-get="{% url 'products:featured' %}"
           hx-trigger="revealed"
           hx-swap="innerHTML"
           id="featured-products-grid"
           aria-live="polite">
        <!-- featured product cards inserted here by HTMX -->
      </div>
    </div>
  </section>

  <!-- TRUST & AUTHENTICITY (short & visible) -->
  <section class="py-16 px-6 bg-black">
    <div class="max-w-7xl mx-auto grid md:grid-cols-2 gap-8 items-center">
      <div>
        <h3 class="text-2xl font-bold">Trust & Cultural Respect</h3>
        <p class="mt-4 text-neutral-300">
          Verified vendors. Clear provenance. Responsible listings — we do not allow exaggerated medical claims.
        </p>
        <ul class="mt-4 text-neutral-400 list-disc list-inside space-y-2">
          <li>Vendor verification & provenance details</li>
          <li>Curated listings with origin metadata</li>
          <li>Buyer protection & returns where applicable</li>
        </ul>
      </div>
      <div class="rounded-2xl bg-neutral-900 p-6 border border-neutral-800 text-neutral-400">
        <p>“Afrimarket connects artisans to a global market while preserving cultural context.”</p>
      </div>
    </div>
  </section>

  <!-- SOCIAL PROOF / STATS (lightweight) -->
  <section class="py-16 bg-neutral-950">
  <div class="max-w-7xl mx-auto grid grid-cols-2 md:grid-cols-4 gap-4">
    <div x-data="{ count: 0 }" x-init="setInterval(() => count < 300 ? count++ : count, 10)">
      <p class="text-3xl font-bold text-amber-400" x-text="count + '+'"></p>
	<p class="text-neutral-400 text-sm">Verified Products</p>
    </div>
    <div x-data="{ count: 0 }" x-init="setInterval(() => count < 50 ? count++ : count, 50)">
      <p class="text-3xl font-bold text-amber-400" x-text="count + '+'"></p>
	<p class="text-neutral-400 text-sm">Trusted Vendors</p>
    </div>
    <div x-data="{ count: 0 }" x-init="setInterval(() => count < 20 ? count++ : count, 100)">
      <p class="text-3xl font-bold text-amber-400" x-text="count + '+'"></p>
	<p class="text-neutral-400 text-sm">Categories</p>
    </div>
    <div x-data="{ count: 0 }" x-init="setInterval(() => count < 15 ? count++ : count, 150)">
      <p class="text-3xl font-bold text-amber-400" x-text="count + '+'"></p>
	<p class="text-neutral-400 text-sm">Countries Served</p>
    </div>
  </div>
</section>

<!--  <section class="py-16 bg-neutral-950">
    <div class="max-w-7xl mx-auto grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
      <div>
<p class="text-3xl font-bold text-amber-400">300+</p>
<p class="text-neutral-400 text-sm">Verified Products</p>
</div>
      <div>
<p class="text-3xl font-bold text-amber-400">50+</p>
<p class="text-neutral-400 text-sm">Trusted Vendors</p>
</div>
      <div>
<p class="text-3xl font-bold text-amber-400">20+</p>
<p class="text-neutral-400 text-sm">Categories</p></div>
      <div>
<p class="text-3xl font-bold text-amber-400">15+</p>
<p class="text-neutral-400 text-sm">Countries Served</p>
</div>
    </div>
  </section>
-->

  <!-- VENDOR CTA -->
  <section id="vendors" class="py-16 px-6 bg-black text-center">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-2xl font-bold">Are you an artisan or herbalist?</h2>
      <p class="mt-4 text-neutral-300">Join Afrimarket to sell to a global audience — we handle logistics, verification and payments.</p>
      <a href="{#% url 'accounts:vendor_register' %}" class="inline-block mt-8 px-10 py-3 bg-amber-500 text-black rounded-xl font-semibold">Become a Vendor</a>
    </div>
  </section>

  <!-- SHORT DISCLAIMER (required) -->
  <section class="py-12 px-6 bg-neutral-950">
    <div class="max-w-4xl mx-auto text-center text-neutral-400 text-sm">
      <p>
        Products listed on Afrimarket may be traditional remedies or cultural artifacts.
        They are not a substitute for professional medical advice. Always consult a qualified healthcare provider for medical issues.
      </p>
    </div>
  </section>

  <!-- FINAL CTA -->
  <section class="py-12 px-6 bg-black text-center">
    <div class="max-w-4xl mx-auto">
      <a href="#featured-products" class="inline-block mt-4 px-10 py-3 bg-amber-500 text-black rounded-xl font-semibold">Start Exploring</a>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="py-10 px-6 border-t border-neutral-800 text-sm text-neutral-500">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between gap-4">
      <span>© Afrimarket</span>
      <nav class="space-x-4">
        <a href="{#% url 'core:about' %}" class="text-neutral-400 hover:text-amber-400">About</a>
        <a href="{#% url 'core:contact' %}" class="text-neutral-400 hover:text-amber-400">Contact</a>
        <a href="{#% url 'core:terms' %}" class="text-neutral-400 hover:text-amber-400">Terms</a>
      </nav>
    </div>
  </footer>

  <!-- Cart Drawer (keeps behavior consistent with your base) -->
  <div x-data="{ cartOpen: false }" x-show="cartOpen"
       x-transition class="fixed top-0 right-0 h-full w-80 bg-neutral-900 shadow-lg z-50 overflow-y-auto">
    <div class="p-4 flex justify-between items-center border-b border-neutral-700">
      <h2 class="text-lg font-semibold">Your Cart</h2>
      <button @click="cartOpen = false" class="text-gray-400 hover:text-gray-200">&times;</button>
    </div>
    <div class="p-4" id="cart-content"
         hx-get="{% url 'orders:cart-items' %}"
         hx-trigger="load"
         hx-target="#cart-content"
         hx-swap="innerHTML">
      <p class="text-gray-400">Loading...</p>
    </div>
  </div>

  <!-- Search Modal -->
  <div x-data="{ searchOpen: false }" x-show="searchOpen"
       x-transition class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div @click.away="searchOpen = false" class="bg-neutral-900 w-full max-w-md p-6 rounded-lg shadow-lg">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold">Search Products</h2>
        <button @click="searchOpen = false" class="text-gray-400 hover:text-gray-200">&times;</button>
      </div>
      <input type="text" placeholder="Search for beads, medicines, sculptures..."
             class="w-full border border-neutral-700 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-400"
             hx-get="{% url 'products:search-products' %}"
             hx-trigger="keyup changed delay:300ms"
             hx-target="#search-results"
             hx-swap="innerHTML">
      <div id="search-results" class="mt-4">
        <p class="text-gray-400">Start typing to see products...</p>
      </div>
    </div>
  </div>

</main>

<!-- JSON-LD for Organization + (injected) featured products after HTMX swap -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Afrimarket",
  "url": "{{ request.scheme }}://{{ request.get_host }}",
  "logo": "{{ request.scheme }}://{{ request.get_host }}{% static 'images/logo.png' %}"
}
</script>

<!-- When HTMX inserts featured items, it will call `window.injectFeaturedJsonLD(data)` to add product schema -->
<script>
  // Called by the HTMX response (see products:view)
  window.injectFeaturedJsonLD = function(products) {
    // products = [{id, name, image, price, url, vendor}]
    const items = products.slice(0,8).map(p => ({
      "@type": "Product",
      "name": p.name,
      "image": p.image,
      "description": p.description || "",
      "sku": String(p.id),
      "offers": {
        "@type": "Offer",
        "priceCurrency": "USD",
        "price": String(p.price),
        "availability": "https://schema.org/InStock",
        "url": p.url
      },
      "brand": { "@type": "Brand", "name": p.vendor }
    }));
    const ld = { "@context": "https://schema.org", "@type": "ItemList", "itemListElement": items };
    const script = document.createElement('script');
    script.type = 'application/ld+json';
    script.id = 'featured-products-ld';
    script.text = JSON.stringify(ld);
    // remove old
    const prev = document.getElementById('featured-products-ld');
    if (prev) prev.remove();
    document.body.appendChild(script);
  };
</script>

{% endblock %}
